services:
  # 1. The Telegram Bot (Runs as a worker because it uses polling)
  - type: worker
    name: aau-grade-bot
    runtime: python
    buildCommand: pip install -r requirements.txt
    startCommand: python main.py
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.0
      - fromGroup: aau-bot-secrets

  # 2. Celery Worker (Handles the actual scraping)
  - type: worker
    name: aau-grade-worker
    runtime: python
    buildCommand: pip install -r requirements.txt
    startCommand: celery -A workers.celery_app worker --loglevel=info
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.0
      - fromGroup: aau-bot-secrets

  # 3. Celery Beat (The Scheduler - runs every 30 mins)
  - type: worker
    name: aau-grade-beat
    runtime: python
    buildCommand: pip install -r requirements.txt
    startCommand: celery -A workers.celery_app beat --loglevel=info
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.0
      - fromGroup: aau-bot-secrets